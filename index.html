<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>JOJO Game</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link href="index.css" rel="stylesheet" />
  </head>

  <body onload="startGame()">
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"
    ></script>

    <div class="ratio ratio-4x3">
      <div class="canvas-wrap">
        <canvas
          class="cover-fit"
          id="myCanvas"
          width="100%"
          height="100%"
        ></canvas>
      </div>
    </div>
    <script>
      var myGamePiece;
      var myBackground;

      var gamecanvas = document.getElementById("myCanvas");
      var bgwidth = gamecanvas.width;
      var bgheight = gamecanvas.height;
      var dios = [];
      var sec = 30;

      function startGame() {
        myGamePieceCheng = new component(
          125,
          125,
          "img/CH_cheng.png",
          200,
          400,
          "image",
          10,
          0
        );

        myBackground = new component(
          800,
          600,
          "img/bg.jpg",
          0,
          0,
          "image",
          0,
          0
        );

        myGameTimer = new component(
          "45px",
          "Comic Sans MS",
          "red",
          5,
          150,
          "text",
          0,
          0
        );
        myGameArea.start();
      }

      var myGameArea = {
        canvas: gamecanvas,
        start: function () {
          this.canvas.width = 800;
          this.canvas.height = 600;
          this.context = this.canvas.getContext("2d");
          document.body.insertBefore(this.canvas, document.body.childNodes[0]);
          this.frameNo = 0;
          this.interval = setInterval(updateGameArea, 20);
        },
        clear: function () {
          this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        },
        stop: function () {
          clearInterval(this.interval);
        },
      };

      function component(width, height, color, x, y, type, speedx, speedy) {
        this.type = type;
        if (type == "image") {
          this.image = new Image();
          this.image.src = color;
        }
        if (type == "text") {
          this.text = "" + sec;
        }

        this.width = width;
        this.height = height;
        this.speedX = speedx;
        this.speedY = speedy;
        this.x = x;
        this.y = y;
        this.update = function () {
          ctx = myGameArea.context;
          if (type == "image") {
            ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
          } else if (this.type == "text") {
            ctx.font = this.width + " " + this.height;
            ctx.fillStyle = color;
            ctx.fillText(this.text, this.x, this.y);
          } else {
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
          }
        };
        this.newPos = function () {
          ctx = myGameArea.context;
          if (this.x + 125 > 800) {
            this.speedX = -this.speedX;
            // ctx.translate((700 + this.width),0);
            // ctx.scale(-1,1);
          }
          if (this.x < 0) {
            this.speedX = -this.speedX;
          }

          if (this.y > 600) {
            dios.pop();
          }

          this.x += this.speedX;
          this.y += this.speedY;
        };
      }

      function updateGameArea() {
        ctx = myGameArea.context;
        if (sec == 0) {
          myGameArea.stop();
        }

        myGameArea.clear();
        myBackground.newPos();
        myBackground.update();
        myGamePieceCheng.newPos();
        myGamePieceCheng.update();

        myGameArea.frameNo += 1;
        if (everyinterval(50)) {
          sec--;
          if (sec < 10) {
            myGameTimer.text = "0" + sec;
          } else {
            myGameTimer.text = "" + sec;
          }
        }
        if (myGameArea.frameNo == 1 || everyinterval(150)) {
          dropDio();
        }
        for (i = 0; i < dios.length; i++) {
          dios[i].newPos();
          dios[i].update();
        }

        myGameTimer.update();
      }

      function dropDio() {
        while (dios.length < 6) {
          var myGamePieceDio = new component(
            125,
            125,
            "img/CH_DIO.png",
            random(0, 700),
            50,
            "image",
            0,
            random(5, 10)
          );
          dios.push(myGamePieceDio);
        }
      }

      function clearmove() {
        myGamePiece.image.src = "CH_DIO.png";
        myGamePiece.speedX = 0;
        myGamePiece.speedY = 0;
      }

      function random(min, max) {
        var num = Math.floor(Math.random() * (max - min)) + min;
        return num;
      }

      function everyinterval(n) {
        if ((myGameArea.frameNo / n) % 1 == 0) {
          return true;
        }
        return false;
      }
    </script>
  </body>
</html>
