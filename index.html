<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>JOJO Game</title>
    <link href="index.css" rel="stylesheet" />
    <script
      type="text/javascript"
      src="http://code.jquery.com/jquery-3.1.1.min.js"
    ></script>
  </head>

  <body onload="main()">
    <div id="menu">
      <div id="main">
        <a href="javascript:void(0)" class="button play">Game Start</a>
      </div>
    </div>
<<<<<<< HEAD
    <script>
      var myGamePiece;
      var myBackground;

      var gamecanvas = document.getElementById("myCanvas");
      var bgwidth = gamecanvas.width;
      var bgheight = gamecanvas.height;
      var dios = [];
      var sec = 30;

      function startGame() {
        myGamePieceCheng = new component(
          125,
          125,
          "img/CH_cheng.png",
          200,
          400,
          "image",
          10,
          0
        );

        myBackground = new component(
          800,
          600,
          "img/bg.jpg",
          0,
          0,
          "image",
          0,
          0
        );

        myGameTimer = new component(
          "45px",
          "Comic Sans MS",
          "red",
          5,
          150,
          "text",
          0,
          0
        );
        myGameArea.start();
      }

      var myGameArea = {
        canvas: gamecanvas,
        start: function () {
          this.canvas.width = 800;
          this.canvas.height = 600;
          this.context = this.canvas.getContext("2d");
          document.body.insertBefore(this.canvas, document.body.childNodes[0]);
          this.frameNo = 0;
          this.interval = setInterval(updateGameArea, 20);
        },
        clear: function () {
          this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        },
        stop: function () {
          clearInterval(this.interval);
        },
      };

      function component(width, height, color, x, y, type, speedx, speedy) {
        this.type = type;
        if (type == "image") {
          this.image = new Image();
          this.image.src = color;
        }
        if (type == "text") {
          this.text = "" + sec;
        }

        this.width = width;
        this.height = height;
        this.speedX = speedx;
        this.speedY = speedy;
        this.x = x;
        this.y = y;
        this.update = function () {
          ctx = myGameArea.context;
          if (type == "image") {
            ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
          } else if (this.type == "text") {
            ctx.font = this.width + " " + this.height;
            ctx.fillStyle = color;
            ctx.fillText(this.text, this.x, this.y);
          } else {
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
          }
        };
        this.newPos = function () {
          ctx = myGameArea.context;
          if (this.x + 125 > 800) {
            this.speedX = -this.speedX;
            // ctx.translate((700 + this.width),0);
            // ctx.scale(-1,1);
          }
          if (this.x < 0) {
            this.speedX = -this.speedX;
          }

          this.x += this.speedX;
          this.y += this.speedY;
        };
      }

      function testing_click(){
        return function(){
          console.log("element clicked!!!")
        };
      }

      function updateGameArea() {

        ctx = myGameArea.context;
        if (sec == 0) {
          myGameArea.stop();
        }

        myGameArea.clear();
        myBackground.newPos();
        myBackground.update();
        myGamePieceCheng.newPos();
        myGamePieceCheng.update();

        myGameArea.frameNo += 1;
        if (everyinterval(50)) {
          sec--;
          if (sec < 10) {
            myGameTimer.text = "0" + sec;
          } else {
            myGameTimer.text = "" + sec;
          }
        }
        if (myGameArea.frameNo == 1 || everyinterval(70)) {
          while(dios.length < 5){
            dropDio();
          }
        }
        for(i = 0; i < dios.length; i++){
          dios[i].addEventListener("click", testing_click)
        }
        /*將超過畫面的dio消除至於此instead of Component*/
        /*-----------------------------------------------*/
        for(i = 0; i < dios.length; i++){
          if(dios[i].y > 500){
            dios.splice(i, 1);
          }
        }
        
        //myGamePieceDio.setAttribute("onclick", myGamePieceDio.remove())
        
        /*-----------------------------------------------*/
        for (i = 0; i < dios.length; i++) { 
          dios[i].newPos();
          dios[i].update();
        }

        myGameTimer.update();
      }

      function dropDio() {
        //將dropDio的interval改成70
        //while (dios.length < 6) {
        var myGamePieceDio = new component(
          125,
          125,
          "img/CH_DIO.png",
          random(0, 700),  //position of x coor
          50,
          "image",
          0,
          random(4, 8)   //speed of falling
        );
        //myGamePieceDio.onclick = function(){alert('blah')};
        //myGamePieceDio.addEventListener("onclick", function(){alert("umm")});
        dios.push(myGamePieceDio);
        //}
      }

      function clearmove() {
        myGamePiece.image.src = "CH_DIO.png";
        myGamePiece.speedX = 0;
        myGamePiece.speedY = 0;
      }

      function random(min, max) {
        var num = Math.floor(Math.random() * (max - min)) + min;
        return num;
      }

      function everyinterval(n) { 
        if ((myGameArea.frameNo / n) % 1 == 0) {
          return true;
        }
        return false;
      }
    </script>
=======
    <div class="canvas-wrap">
      <canvas class="cover-fit" id="myCanvas"></canvas>
    </div>
    <div id="game-over">
      <!-- <div id="end"> -->
      <!-- <a href="javascript:void(0)" class="button leave">Leave</a>
        <a href="javascript:void(0)" class="button restart">Try again?</a> -->
      <p class="textGameOver">Game Over</p>
      <button class="leave endbutton">Leave</button>
      <button class="restart endbutton">Try again</button>
      <!-- </div> -->
    </div>
>>>>>>> 6df8c76d18016d41413d1c839abc35bb175ec8e3
  </body>
  <script type="text/javascript" src="game.js"></script>
</html>
